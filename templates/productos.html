{% extends "layout.html" %} {% block content %}

<h2 class="mb-3">Productos</h2>

<!-- FORMULARIO PARA NUEVO PRODUCTO -->
{% if session.get('rol', '').lower() == 'admin' %}
<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <form action="/productos/nuevo" method="POST" class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Nombre</label>
        <input
          type="text"
          name="nombre"
          class="form-control"
          placeholder="Nombre"
          required
        />
      </div>

      <div class="col-md-4">
        <label class="form-label">Categoría</label>
        <input
          type="text"
          name="categoria"
          class="form-control"
          placeholder="Ej: Hogar, Electronica"
          required
        />
      </div>

      <div class="col-md-4">
        <label class="form-label">Precio</label>
        <input
          type="number"
          step="0.01"
          min="0"
          name="precio"
          class="form-control"
          placeholder="50.00"
          required
        />
      </div>

      <div class="col-md-4">
        <label class="form-label">Stock</label>
        <input
          type="number"
          min="0"
          name="stock"
          class="form-control"
          placeholder="100"
          required
        />
      </div>

      <div class="col-12">
        <button class="btn btn-success w-100" type="submit">Agregar Producto</button>
      </div>
    </form>
  </div>
</div>
{% endif %}

<form method="GET" action="/productos/" class="row g-3 mb-4">
  <div class="col-md-10">
    <input
      type="text"
      name="buscar"
      value="{{ buscar }}"
      class="form-control"
      placeholder="Buscar por ID o nombre"
    />
  </div>

  <div class="col-md-2">
    <button class="btn btn-primary w-100" type="submit">Buscar</button>
  </div>
</form>

<!-- TABLA DE PRODUCTOS -->
<table class="table table-bordered table-striped shadow-sm">
  <thead class="table-primary">
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Categoría</th>
      <th>Precio</th>
      <th>Stock</th>
      <th>Fecha Alta</th>
      <th>Activo</th>
      {% if session.get('rol', '').lower() == 'admin' %}
      <th>Acciones</th>
      {% endif %}
    </tr>
  </thead>

  <tbody>
    {% for p in productos %}
    <tr>
      <td>{{ p.idproducto }}</td>
      <td>{{ p.nombre }}</td>
      <td>{{ p.categoria }}</td>
      <td>${{ "%.2f"|format(p.precio) }}</td>
      <td>{{ p.stock }}</td>
      <td>{{ p.fecha_alta }}</td>
      <td>{% if p.activo == 1 %}Activo{% else %}Inactivo{% endif %}</td>

      {% if session.get('rol', '').lower() == 'admin' %}
      <td>
        <a href="/productos/detalle/{{ p.idproducto }}" class="btn btn-sm btn-primary"
          >Editar</a
        >
        <a
          href="/productos/eliminar/{{ p.idProducto }}"
          onclick="return confirm('¿Eliminar producto?')"
          class="btn btn-sm btn-danger"
        >
          Eliminar
        </a>
      </td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
